# Project Structure Document

This document outlines the directory and file layout for the Astral API project. The structure is designed to promote high modularity, maintainability, and adherence to industry best practices.

## Directory Layout

```
project-root/
├── app/                           # Main application package
│   ├── __init__.py                # Package initialization
│   ├── main.py                    # Entry point to start the FastAPI application
│   ├── components/                # API routes organized by resource
│   │   ├── __init__.py
│   │   ├── location_proofs.py     # Endpoints related to location proofs (EAS attestations)
│   │   ├── authentication.py      # Endpoints for Web3 sign-in and user management
│   │   └── health.py              # Health-check and status endpoints
│   ├── models/                    # Database models (SQLAlchemy models)
│   │   └── __init__.py
│   ├── schemas/                   # Pydantic models for request/response validation
│   │   └── __init__.py
│   ├── services/                  # Business logic and integrations
│   │   ├── __init__.py
│   │   ├── eas_integration.py     # Functions to interact with the EAS GraphQL endpoint
│   │   ├── scheduler.py           # Scheduler to periodically ping the EAS endpoint
│   │   └── graphql_proxy.py       # GraphQL resolvers and proxy logic (using Ariadne)
│   └── utils/                     # Utility functions and helpers
│       └── __init__.py
│
├── alembic/                       # Database migrations (using Alembic)
│   ├── env.py
│   ├── script.py.mako
│   └── versions/                  # Migration scripts
│
├── tests/                         # Test suite organized by type
│   ├── unit/                      # Unit tests for isolated functions and modules
│   │   └── __init__.py
│   └── integration/               # Integration tests (e.g., API endpoint tests)
│       └── __init__.py
│
├── config/                        # Configuration files and settings
│   ├── __init__.py
│   └── settings.py                # Central settings module using Pydantic's BaseSettings
│
├── docs/                          # Project documentation (using MkDocs)
│   ├── index.md
│   └── mkdocs.yml                 # MkDocs configuration file
│
├── Dockerfile                     # Dockerfile for containerizing the FastAPI application
├── docker-compose.yml             # Docker Compose file for local development (spinning up API, Postgres, etc.)
├── requirements.txt               # Python dependencies
├── pyproject.toml                 # Build and tool configuration (optionally, for Black, isort, etc.)
├── .pre-commit-config.yaml        # Pre-commit hooks for Black, isort, Flake8, and mypy
├── .gitignore                     # Git ignore file
└── README.md                      # Project overview and setup instructions
```

## Decisions and Rationale

1. **Subdirectory Details:**
   - **Scheduler:** A dedicated module (`app/services/scheduler.py`) is included to periodically ping the EAS GraphQL endpoint. We can start with a one-minute interval (or adjust to one second if a user is online) based on runtime metrics and best practices.
   - **Database Migrations:** An `alembic/` directory is included to manage database migrations, which is best practice when using SQLAlchemy.

2. **Configuration Management:**
   - **Central Settings Module:** Configuration is handled via a central settings module (`config/settings.py`) using Pydantic’s BaseSettings. This allows secure handling of environment variables and centralized configuration management.

3. **API Routing:**
   - **Granular Organization:** Endpoints are organized under `app/components/` by resource (e.g., location proofs, authentication, health). This modular approach ensures each module is focused on a single responsibility and keeps the code highly organized.

4. **Testing Organization:**
   - **Separated Tests:** The `tests/` directory is split into `unit/` and `integration/` folders. This separation helps keep tests modular and prevents any one test file from becoming too large.

5. **Deployment Files:**
   - **Containerization:** Both a `Dockerfile` and a `docker-compose.yml` are included. Docker Compose is useful for local development, orchestrating the API and the Postgres database.
   - **Cloud Deployment:** Although Kubernetes manifests aren’t included at this stage, our AWS deployment will eventually use container orchestration via ECS/Fargate.

6. **Documentation:**
   - **MkDocs:** We’re using MkDocs for project documentation. The `docs/` directory contains our Markdown-based documentation and configuration for MkDocs. Additionally, OpenAPI/Swagger docs will be automatically generated by FastAPI.
